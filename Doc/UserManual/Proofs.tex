%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%%   BornAgain User Manual
%%
%%   homepage:   http://www.bornagainproject.org
%%
%%   copyright:  Forschungszentrum Jülich GmbH 2015
%%
%%   license:    Creative Commons CC-BY-SA
%%   
%%   authors:    Scientific Computing Group at MLZ Garching
%%               C. Durniak, M. Ganeva, G. Pospelov, W. Van Herck, J. Wuttke
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Some proofs}  \label{sec:Proofs}

This appendix contains proofs that were taken out of the main text
in order not to disrupt the physics narration.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Source-detector reciprocity for the scalar Schrödinger equation}
  \label{Sreci1}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\textit{reciprocity}
\index{Reciprocity|(}%
\index{Green function!reciprocity}%
of Green functions for self-adjoint differential equations.

Let us derive the reciprocity theorem
for a generic stationary Schrödinger equation
with an isolated inhomogeneity,
\begin{equation}\label{EgsSchrodi}
  \left\{\Nabla^2+v(\r)\right\}G(\r,\rS) = \delta(\r-\rS).
\end{equation}
We assume that $\rS$ lies within our sample.
Outside the sample volume
the potential~$v(\r)$ has the constant value~$K^2$
so that (\ref{EgsSchrodi})
reduces to the Helmholtz equation%
\begin{equation}\label{EgsSchrodiHelmh}
  \left\{\Nabla^2+K^2\right\}G(\r,\rS) = 0.
\end{equation}
We introduce the adjoint Green function~$B$
\nomenclature[2b030 2r040 2r041]{$B(\r,\r')$}{Green function, adjoint of $G$}%
that originates from a source term at the detector location
and obeys
\begin{equation}\label{EgsSchrodiAdj}
  \left\{\Nabla^2+v(\r)\right\}B(\r,\rD) = \delta(\r-\rD).
\end{equation}
We also introduce the auxiliary vector field
\begin{equation}
  \v{X}(\r,\rS,\rD):=B(\r,\rD)\Nabla G(\r,\rS) - G(\r,\rS)\Nabla B(\r,\rD).
\end{equation}
\nomenclature[2x150 2r040]{$\v{X}(\r,\rS,\rD)$}{Auxiliary vector field}%
We inscribe the sample, the detector, and the origin of the coordinate system
into a sphere $\Sphere$ with radius~$R$,
\nomenclature[2s180]{$\Sphere$}{Auxiliary spherical volume}%
\nomenclature[2r120]{$R$}{Radius of $\Sphere$}%
and compute the volume integral
\begin{equation}\label{Eprerecipro}
  \begin{array}{lcl}
    I(\rS,\rD)
  &=& \displaystyle\int_\Sphere\!\d^3r\,\Nabla \v{X}(\r,\rS,\rD)
  \\[1.8em]
  &=& \displaystyle\int_\Sphere\!\d^3r\,\left(
    B\Nabla^2 G- G\Nabla^2 B \right)
  \\[1.4em]
  &=&  B(\rS,\rD) - G(\rD,\rS).
  \end{array}
\end{equation}
Alternatively, we can compute $I$ as a surface integral
\begin{equation}
  I(\rS,\rD)
  =\displaystyle\int_{\partial\Sphere}\d\v{\sigma}\,\v{X}(\r,\rS,\rD)
  =\displaystyle\int_{\partial\Sphere}\d{\sigma}\,
       \left(B\partial_R G - G\partial_R B\right).
\end{equation}
On the surface $\partial\Sphere$,
$B$ and $G$ are outgoing wave fields that obey the Helmholtz equation.
Solutions of this equation in spherical coordinates
have a well-known series expansion.
We send $R\to\infty$ so that we need only to retain the lowest order,
the form of which has been anticipated
in the boundary condition~(\ref{Escabouco}),
\begin{equation}
   G(\r(R,\vartheta,\varphi),\rS)
   \doteq \frac{\e^{iKR}}{4\pi R} g(\vartheta,\varphi),
\end{equation}
and similarly 
\begin{equation}
   B(\r(R,\vartheta,\varphi),\rD)
   \doteq \frac{\e^{iKR}}{4\pi R} b(\vartheta,\varphi).
\end{equation}
The functions $g$ and $b$ can be further expanded into spherical harmonics,
but this is of no interest here.
The decisive point is the factorization of $G$ and $B$
and their common $R$ dependence.
It follows at once that
\begin{equation}
  I(\rS,\rD)
  =\displaystyle\int_{\partial\Sphere}\d\sigma\,
       (\text{$R$-dependent})(bg-gb)
  = 0.
\end{equation}
From (\ref{Eprerecipro}) we obtain the \textit{reciprocity theorem}
\begin{equation}\label{Ereci}
  G(\rD,\rS) = B(\rS,\rD).
\end{equation}
To obtain the forward-propagating Green function~$G$,
it is sufficient to determine the adjoint Green function~$B$
that traces a neutron back from the detector position~$\rD$
to a scattering center~$\rS$.
\index{Reciprocity|)}%

The solution $B(\r,\rD)$ of (\ref{EgsSchrodiAdj})
is analogous to (\ref{EGreens1}).
Choosing the origin inside the sample,
and assuming that $\rD$ lies far outside the sample,
we can copy the far-field expansion from~(\ref{EGreenFar})
to obtain
\index{Far-field approximation}%
\begin{equation}\label{EBFar}
  B_\text{far}(\r,\rD)
  =\frac{\e^{iKr_\text{D}}}{4\pi r_\text{D}}\e^{-i\k_\tf \r}.
\end{equation}
When this backward propagating plane waves impinges on the sample,
it undergoes reflection and refraction in exactly the same way as
the incident plane wave $\e^{i\k_\ti\r}$.
Therefore,
 (\ref{EBFar}) admits a generalization that also holds inside the sample:
\begin{equation}\label{EBFull}
  B_\text{far}(\r,\rD)
  = \frac{\e^{iKr_\text{D}}}{4\pi r_\text{D}}\psi^*_\tf(\r).
\end{equation}
Applying now the reciprocity theorem (\ref{Ereci}),
we can conclude that the far-field Green function
is still given by (\ref{EGreenFar}),
though $\psi_\tf$ no longer is a plane wave.
Accordingly,
the scattered far-field is still given by (\ref{EsandwichC}),
and the differential cross section by (\ref{Exsection}).

