%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%%   BornAgain User Manual
%%
%%   homepage:   http://www.bornagainproject.org
%%
%%   copyright:  Forschungszentrum JÃ¼lich GmbH 2015
%%
%%   license:    Creative Commons CC-BY-SA
%%   
%%   authors:    Scientific Computing Group at MLZ Garching
%%               C. Durniak, M. Ganeva, G. Pospelov, W. Van Herck, J. Wuttke
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newpage
\chapter{Installation} \SecLabel{Installation}

\BornAgain\ is supported under x86/x86\_64 Linux, Mac OS X and Windows operating systems. 
It has been successfully compiled and tested on
\begin{itemize}
\item Microsoft Windows 7 64-bit, Windows 8 64-bit
\item Mac OS X 10.8 (Mountain Lion), 10.9 (Maverick)
\item OpenSuse 12.3 64-bit
\item Ubuntu 12.10, 13.04 64-bit
\item Debian 7.1.0, 32-bit, 64-bit
\end{itemize}

At the moment we support build and installation from source on Unix Platforms 
(Linux, Mac OS) and
installation using binary installer packages on MS Windows 7, 8 (see
\SecRef{InstallationUnix} and \SecRef{InstallationWindows}, respectively).
In the next releases we are planning to provide binary installers for 
Mac OS X and Debian.

We welcome feedback and bug reports related to
installation and use of \BornAgain\
 via \url{http://apps.jcns.fz-juelich.de/redmine/projects/bornagain/issues}


\section{Building and installing on Unix Platforms} \SecLabel{InstallationUnix}


\BornAgain\ uses \Code{CMake} to configure a build system for compiling and installing the framework. There are three major steps to build \BornAgain\ :
\begin{enumerate}[1.]
\item Acquiring the required third-party libraries.
\item Getting \BornAgain\ source code.
\item Using \Code{CMake} to build and install the software.
\end{enumerate}
The remainder of this section explains each step in detail.

\subsection{Third-party software}
To successfully build \BornAgain\ a number of prerequisite packages must be installed.

\begin{itemize}
\item compilers: clang  versions $\geq 3.1$ or GCC versions $\geq 4.1.2$
\item cmake ($\geq 2.8.3$)
\item boost library ($\geq 1.48$)
\item GNU scientific library ($\geq 1.15$)
\item fftw3 library ($\geq 3.3$)
\item \Python\ ($\geq 2.7$, $< 3.0$), python-devel, python-numpy-devel, python-matplotlib
\end{itemize}
\vspace*{2mm}

Other packages are optional
\begin{itemize}
\item ROOT framework (adds several additional fitting algorithms to \BornAgain)
%\item Eigen3 library ($\geq 3.1.0$)
\end{itemize}

All required packages can be easily installed on most Linux distributions using the system's package
manager. Below we give examples for a few selected operation systems. Please note,
that other distributions (Fedora, Mint, etc) may have different
commands for invoking the package manager as well as slightly different names of packages (like ``boost'' instead of ``libboost'' etc). Besides  the installation should be very similar.
\vspace*{3mm}


% ---------------
%  Ubuntu 13.04
% ---------------
\noindent
{\large\bf Ubuntu (12.10, 13.04), Debian (7.1)} \newline
Installing the required packages
\begin{lstlisting}[language=shell, style=commandline]
sudo apt-get install git cmake libgsl0-dev libboost-all-dev libfftw3-dev python-dev python-numpy python-matplotlib python-matplotlib-tk
\end{lstlisting}

\noindent
Installing the optional packages
\begin{lstlisting}[language=shell, style=commandline]
sudo apt-get install root-system
\end{lstlisting}
\vspace*{3mm}


% ---------------
%  OpenSuse 12.3
% ---------------
\noindent
{\large\bf OpenSuse 12.3} \newline

\noindent
Installing the required packages
\begin{lstlisting}[language=shell, style=commandline]
sudo zypper install git-core cmake gsl-devel boost-devel fftw3-devel python-devel python-numpy-devel python-matplotlib python-matplotlib-tk
\end{lstlisting}

\noindent
Installing the optional packages. First add the ``scientific'' repository for your version of OpenSuse


\noindent
\begin{lstlisting}[language=shell, style=commandline]
sudo zypper ar http://download.opensuse.org/repositories/science/openSUSE_12.3 science
\end{lstlisting}

\noindent
Then install optional ROOT framework
\begin{lstlisting}[language=shell, style=commandline]
sudo zypper root-system 
\end{lstlisting}
\vspace*{3mm}



% ---------------
%  MacOS 10.8
% ---------------
\noindent
\noindent
{\large\bf Mac OS X 10.8, 10.9} \newline
To simplify the installation of third party open-source software on a Mac OS X system we recommend the use of \Code{MacPorts} package manager. 
The easiest way to install MacPorts is by downloading the \Code{dmg} 
from \url{www.macports.org/install.php} and running the system's installer.
After the installation new command ``\Code{port}'' will be available
in a terminal window of your Mac. \


\noindent
Installing the required packages
\begin{lstlisting}[language=shell, style=commandline]
sudo port -v selfupdate
sudo port install git-core cmake
sudo port install fftw-3 gsl
sudo port install boost -no_single-no_static+python27 
sudo port install py27-matplotlib py27-numpy py27-scipy
sudo port select --set python python27
\end{lstlisting}

\noindent
Installing the optional packages
\begin{lstlisting}[language=shell, style=commandline]
sudo port install root +fftw3+python27
\end{lstlisting}




\subsection{Getting {\rm\bf BornAgain} source code}
\BornAgain\ source can be downloaded at \url{http://apps.jcns.fz-juelich.de/BornAgain}
and unpacked with
\begin{lstlisting}[language=shell, style=commandline]
tar xfz BornAgain-<version>.tar.gz
\end{lstlisting}

\noindent
Alternatively one can obtain \BornAgain\ source from our public Git repository.
\begin{lstlisting}[language=shell, style=commandline]
git clone git://apps.jcns.fz-juelich.de/BornAgain.git 
\end{lstlisting}
\vspace*{3mm}


\noindent
{\bf\large More about Git} \\
Our Git repository holds two main branches called ``master'' and ``develop''. We consider ``master''
branch to be the main branch where the source code of HEAD always
reflects the latest stable release. \Code{git clone} command shown above
\begin{enumerate}[1.]
\item gives you a source code snapshot corresponding to the latest stable release,
\item automatically sets up your local master branch to track our remote master branch, 
so you will be able to fetch changes from the remote branch at any time using \Code{git pull} command.
\end{enumerate}

``Master'' branch is updated approximately once per month.
% that reflects our release cycle.
The second branch, ``develop'' branch, is a snapshot of the current development.
This is where any automatic nightly builds are built from. The develop branch is
always expected to work. So in order to get the most recent features
of the source code, one can switch to it by
\begin{lstlisting}[language=shell, style=commandline]
cd BornAgain
git checkout develop
git pull
\end{lstlisting}
\vspace*{3mm}



\subsection{Building and installing the code}

\BornAgain\ should be built using \Code{CMake} cross platform build system. 
Having the third-party libraries installed on your system and
\BornAgain\ source code acquired as explained in the
previous sections, type the build commands
\begin{lstlisting}[language=shell, style=commandline]
mkdir <build_dir>
cd <build_dir>
cmake  -DCMAKE_INSTALL_PREFIX=<install_dir> <source_dir>
make -j4
\end{lstlisting}
\vspace*{3mm}

Here \Code{<source\_dir>} is the name of the directory, where \BornAgain\ source code has been
copied, \Code{<install\_dir>} is the directory, where you want the package
to be installed, and \Code{<build\_dir>} is the directory where the building will occur.

\MakeRemark{About \Code{CMake}}{
\\Having a dedicated directory \Code{<build\_dir>} for the build process
is recommended by \Code{CMake}. This allows several builds with
different compilers/options from the same source and keeps the source directory clean from build remnants. \\
}


The compilation process invoked by the command ``make'' lasts about 10 minutes on an average laptop
of 2012 edition. On multi-core machines the compilation time  can be decreased by invoking command
``make'' with the parameter ``make -j[N]'', where N is the number of cores.

Running functional tests is an optional but recommended step. Command ``make check''
will compile several additional tests and run them one by one. Each test contains
the simulation of a typical GISAS geometry and the comparison on numerical level of simulation results with reference files. Having 100\% tests passed ensures that your local installation
is correct.
\begin{lstlisting}[language=shell, style=commandline]
make check
...
100% tests passed, 0 tests failed out of 26
Total Test time (real) = 89.19 sec
[100%] Build target check
\end{lstlisting}
\vspace*{3mm}


The last command ``make install'' copies the compiled libraries and some usage examples
into  the installation directory.
\begin{lstlisting}[language=shell, style=commandline]
make install
\end{lstlisting}

\subsubsection{After installation}


After the installation is completed, the location of \BornAgain\ libraries needs to be included into your
\Code{LD\_LIBRARY\_PATH} and \Code{PYTHONPATH} environment variables.
This can be done by running \BornAgain\ setup script in the terminal session
\begin{lstlisting}[language=shell, style=commandline]
source <install_dir>/bin/thisbornagain.sh
\end{lstlisting}
Conveniently, a given call can be placed in your \Code{.bashrc} file.


\subsubsection{Troubleshooting}

In the case of a complex system setup, with libraries of different versions 
scattered across multiple places (\Code{/opt/local}, \Code{/usr/local} etc.),
you may want to help \Code{CMake} in finding the correct library paths
by running cmake with additional parameter 
\begin{lstlisting}[language=shell, style=commandline]
cmake -DCMAKE_PREFIX_PATH=/usr/local -DCMAKE_INSTALL_PREFIX=<install_dir> <source_dir>
\end{lstlisting}



\subsection{Running the first simulation}

In your installation directory you will find
\begin{lstlisting}[language=shell, style=commandline, keywordstyle=\color{black}]
./include/BornAgain - header files for compilation of your C++ program
./lib - libraries to import into python or link with your C++ program
./share/BornAgain/Examples - directory with examples
\end{lstlisting}

Run your first example and enjoy the first BornAgain simulation plot.
\begin{lstlisting}[language=shell, style=commandline]
python <install_dir>/share/BornAgain/Examples/python/simulation/ex001_CylindersAndPrisms/CylindersAndPrisms.py
\end{lstlisting}




\section{Installing on Windows Platforms} \SecLabel{InstallationWindows}


\noindent
{\bf Step I: $~$ install the third party software} \newline
The current version of \BornAgain\ requires \Code{Python, numpy, matplotlib} 
to be installed on the system. 

\subsubsection{If you do not have have Python installed}
You can use \Code{PythonXY} installer
at \url{https://code.google.com/p/pythonxy} which, with the default installation options, contains at least these three packages.
The user has to download and install this package before proceeding to
the installation of \BornAgain.
\vspace*{2mm}


\subsubsection{If you have Python already installed}
You might want to keep using this installation and to install the missing modules. Therequired libraries can be found at
\begin{lstlisting}[language=shell, style=commandline]
matlab:
http://matplotlib.org/downloads.html

numpy, dateutil, pyparsing:
http://www.lfd.uci.edu/~gohlke/pythonlibs
\end{lstlisting}


\noindent
{\bf Step II: $~$ use the installation package } \newline
\BornAgain\ installation package for Windows can be downloaded from \url{http://apps.jcns.fz-juelich.de/BornAgain}.
Double-click on it to start the installation process. And then follow the instructions.
\vspace*{2mm}

\noindent
{\bf Step IV: $~$ run an example} \newline
Run an example located in \BornAgain\ installation directory:
\begin{lstlisting}[language=shell, style=commandline]
python C:/BornAgain-<Version>/Examples/python/simulation/ex001_CylindersAndPrisms/CylindersAndPrisms.py
\end{lstlisting}


%\MakeRemark{Compiling on Windows}{
%Compilation of \BornAgain\ from source on Windows using Microsoft Visual Studio is %possible, although not easy. Build instructions can be provided on request.
%}



